spring:
  datasource:
    url: ${CLICKHOUSE_URL:jdbc:clickhouse://localhost:8123/polybot}
    driver-class-name: ${CLICKHOUSE_DRIVER:com.clickhouse.jdbc.ClickHouseDriver}
    username: ${CLICKHOUSE_USER:default}
    password: ${CLICKHOUSE_PASSWORD:}

hft:
  mode: PAPER

  # =============================================================================
  # AWARE Fund Configuration
  # =============================================================================
  # Mirrors positions of top traders in the PSI-10 index
  fund:
    enabled: true
    index-type: PSI-10
    capital-usd: 10000
    max-position-pct: 0.10          # Max 10% of capital per position
    min-trade-usd: 5                # Skip trades smaller than $5
    rebalance-interval-seconds: 60  # Check for drift every 60s
    signal-delay-seconds: 5         # Wait 5s after detecting trader trade (anti-front-run)
    max-slippage-pct: 0.02          # Max 2% slippage on market orders
    execution-mode: LIMIT_THEN_MARKET
    risk-limits:
      max-daily-loss-usd: 500       # Hard stop at $500 daily loss
      max-drawdown-pct: 0.10        # Max 10% drawdown
      max-open-positions: 50        # Cap at 50 concurrent positions
      max-single-market-exposure-usd: 1000
      kill-switch-active: false

  events:
    enabled: true
    market-ws-snapshot-publish-millis: 1000
    market-ws-cache-publish-on-start: true
  executor:
    base-url: ${EXECUTOR_BASE_URL:http://localhost:8080}
    send-live-ack: false
  risk:
    kill-switch: false
    max-order-notional-usd: 0
    max-order-size: 30
  polymarket:
    market-ws-enabled: true
    gamma-url: https://gamma-api.polymarket.com
    market-ws-cache-path: .cache/ws/market-ws-cache.strategy.json
    market-ws-cache-flush-millis: 5000
  strategy:
    gabagool:
      enabled: true
      refresh-millis: 1500
      min-replace-millis: 2000          # RECALIBRATED: Reduced from 4s to 2s for faster price tracking
      force-replace-millis: 20000       # Re-quote even if price/size unchanged (queue refresh)
      min-seconds-to-end: 0
      max-seconds-to-end: 3600
      improve-ticks: 0

      # Dynamic sizing: FIXED mode for sim, AUTO_CASH for live
      # RECALIBRATED: GAB avg=18.6, P50=19 shares - increased from 10 to 18
      quote-size: 18
      quote-size-bankroll-fraction: 0.001
      bankroll-mode: FIXED
      bankroll-usd: 10000
      bankroll-refresh-millis: 10000
      bankroll-smoothing-alpha: 0.2
      bankroll-min-threshold: 50
      bankroll-trading-fraction: 0.8
      max-order-bankroll-fraction: 0.03   # Increased from 0.02 to allow larger orders
      max-total-bankroll-fraction: 1.0

      # Complete-set arbitrage configuration
      # NOTE: Top traders don't pre-filter by edge - they quote both sides aggressively
      # Edge emerges from spread capture + inventory skewing, not from strict filtering
      # Gab trades at ~1% median edge, but also participates down to ~0% on active tape.
      # Use wider hysteresis to avoid cancel-churn and keep orders matchable.
      complete-set-min-edge: 0.006                    # Entry edge (0.6%)
      complete-set-cancel-edge: 0.002                 # Cancel edge (0.2%)
      complete-set-max-skew-ticks: 0                  # Max ticks to skew based on inventory
      complete-set-imbalance-shares-for-max-skew: 4000 # Shares imbalance for max skew
      complete-set-top-up-enabled: false
      complete-set-top-up-seconds-to-end: 120         # Start top-up this far from end
      complete-set-top-up-min-shares: 200             # Min imbalance to trigger top-up
      complete-set-fast-top-up-enabled: true
      complete-set-fast-top-up-min-shares: 80         # Min shares for fast top-up (reduce taker frequency)
      complete-set-fast-top-up-min-seconds-after-fill: 2   # Min seconds after fill
      complete-set-fast-top-up-max-seconds-after-fill: 25  # Max seconds after fill
      complete-set-fast-top-up-cooldown-millis: 20000 # Cooldown between fast top-ups
      complete-set-fast-top-up-min-edge: 0.000        # Min edge for fast top-up (0 = break-even)
      complete-set-fast-top-up-fraction: 0.30         # Hedge 30% of imbalance (leave more residual; reduce taker volume)
      complete-set-fast-top-up-probability: 0.30      # RECALIBRATED: Increased from 0.10 to reduce NO_SIM rate
      complete-set-hedge-delay-enabled: false         # DISABLED: Hedge delay was causing 80% NO_SIM rate
      complete-set-hedge-delay-min-seconds: 2
      complete-set-hedge-delay-max-seconds: 60        # (Not used when disabled)

      # Taker mode - cross the spread when edge is favorable
      # DISCOVERY: Gab is 100% TAKER (all BUY orders hitting the ASK)
      taker-mode-enabled: true
      taker-mode-max-edge: 0.03                       # AGGRESSIVE: Increased from 0.015 to 3 cents
      taker-mode-max-spread: 0.06                     # AGGRESSIVE: Increased from 0.02 to 6 cents (match observed spreads)
      taker-mode-probability: 0.80                    # AGGRESSIVE: Increased from 0.20 to 0.80 to match gab's 100% taker behavior

  # =============================================================================
  # Multi-Fund Mode Configuration (Alpha Funds)
  # =============================================================================
  # Enable this to run all fund strategies simultaneously
  # =============================================================================
  multi-fund:
    enabled: true
    total-capital-usd: 100000      # Total capital pool across all funds

    funds:
      # =========================================================================
      # PSI MIRROR FUNDS (TIER 1) - Copy trades from top-performing traders
      # =========================================================================
      PSI-10:
        enabled: true
        capital-pct: 15            # 15% → $15,000 - Elite top 10 traders
        max-position-pct: 0.10
        min-trade-usd: 10

      PSI-25:
        enabled: true
        capital-pct: 10            # 10% → $10,000 - Broader top 25
        max-position-pct: 0.08
        min-trade-usd: 10

      PSI-CRYPTO:
        enabled: true
        capital-pct: 10            # 10% → $10,000 - Crypto market specialists
        max-position-pct: 0.10
        min-trade-usd: 10

      PSI-SPORTS:
        enabled: true
        capital-pct: 5             # 5% → $5,000 - Sports betting specialists
        max-position-pct: 0.15
        min-trade-usd: 10

      PSI-ALPHA:
        enabled: true
        capital-pct: 10            # 10% → $10,000 - High alpha generators
        max-position-pct: 0.12
        min-trade-usd: 10

      # =========================================================================
      # ALPHA ACTIVE FUNDS (TIER 2) - Algorithmic signal-based trading
      # =========================================================================
      ALPHA-ARB:
        enabled: true
        capital-pct: 15            # 15% → $15,000 - Complete-set arbitrage
        max-position-pct: 0.05     # Conservative per arb
        min-trade-usd: 20

      ALPHA-INSIDER:
        enabled: true
        capital-pct: 17            # 17% → $17,000 - Follow insider signals
        max-position-pct: 0.15     # Allow conviction plays
        min-trade-usd: 25

      ALPHA-EDGE:
        enabled: true
        capital-pct: 18            # 18% → $18,000 - ML edge detection
        max-position-pct: 0.10
        min-trade-usd: 20

logging:
  level:
    com.polybot.hft.polymarket.strategy: INFO
